@page "/produtos"
@using ContractManagement.UI.Blazor.DTOs
@inject ProdutoServices ProdutoServices

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-6">
    @if (produtos is null)
    {
        <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Small" Class="d-flex mx-auto mt-8" />
    }
    else if (!produtos.Any())
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Filled" Class="mt-6 text-center">
            Nenhum produto encontrado.
        </MudAlert>
    }
    else
    {
        <MudGrid GutterSize="3">
            @foreach (var produto in produtos)
            {
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <MudPaper Elevation="3" Class="hover:shadow-6 transition-all duration-300 rounded-lg">
                        <MudCard Class="h-full d-flex flex-column">
                            <MudCardMedia Image="https://preview.free3d.com/img/2013/02/2146710223417509575/rjg0djt8.jpg"
                            Height="200"
                            Class="rounded-t-lg object-fit-contain" />

                            <MudCardContent Class="p-3 d-flex flex-column justify-between flex-grow-1">
                                <MudText Typo="Typo.h6" Class="font-semibold truncate" Color="Color.Secondary">@produto.Name</MudText>
                                <MudText Typo="Typo.body2" Color="Color.Info" Class="line-clamp-2">
                                    @produto.Description
                                </MudText>

                                <MudSpacer />

                                <MudText Typo="Typo.h5" Color="Color.Primary" Class="font-bold mt-2">
                                    R$ @produto.SalePrice.ToString("N2")
                                </MudText>
                            </MudCardContent>

                            <MudDivider/>
                            <MudCardActions Class="justify-between p-3 gap-2">
                                <MudButton Variant="Variant.Outlined"
                                           Color="Color.Primary"
                                           StartIcon="@Icons.Material.Filled.Info"
                                           Href="@($"/produtos/{produto.Cod}")">
                                    Detalhes
                                </MudButton>

                                <MudButton Color="Color.Primary"
                                           Variant="Variant.Filled"
                                           StartIcon="@Icons.Material.Filled.AddShoppingCart">
                                    Adicionar
                                </MudButton>
                            </MudCardActions>
                        </MudCard>
                    </MudPaper>
                </MudItem>
            }
        </MudGrid>
    }
</MudContainer>

@code {
    private List<ProdutoDto>? produtos;

    protected override async Task OnInitializedAsync()
    {
        produtos = await ProdutoServices.GetAllProdutos();
    }

    private string GetImagem(byte[]? imagem)
    {
        if (imagem is { Length: > 0 })
            return $"data:image/jpeg;base64,{Convert.ToBase64String(imagem)}";

        // Placeholder bonito quando o produto não tem imagem
        return "https://via.placeholder.com/400x300?text=Sem+Imagem";
    }
}
